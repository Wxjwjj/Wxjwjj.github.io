<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="CV/NLP，Studying，Coding">
<meta property="og:type" content="website">
<meta property="og:title" content="Deep Coding">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Deep Coding">
<meta property="og:description" content="CV/NLP，Studying，Coding">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Deep Coding">
<meta name="twitter:description" content="CV/NLP，Studying，Coding">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Deep Coding</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Deep Coding</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            日志
          </a>
        </li>
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/07/Retrieval/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/07/Retrieval/" itemprop="url">两种常用的图像检索算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-07T17:13:30+08:00">
                2018-05-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/07/Retrieval/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/07/Retrieval/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h3><h4 id="Mat类型数据结构"><a href="#Mat类型数据结构" class="headerlink" title="Mat类型数据结构"></a>Mat类型数据结构</h4><p>一个图像的通道数是N，就表明每个像素点处有N个数，一个a×b的N通道图像，其图像矩阵实际上是b行N×a列的数字矩阵。<br><code>p = img.ptr&lt;uchar&gt;(i);</code> 图像第i行的头指针，通过这个指针结合列的位置（就是你代码中的j）可以很轻松操作图像改行的每一列，即p[j]<br><code>samples.at&lt;Vec3f&gt;(k,0)[0] = float(p[j*3]);</code> at &lt;类型&gt; (行,列) [通道(如果有通道的话)]，获取某点像素值</p>
<h4 id="kmeans"><a href="#kmeans" class="headerlink" title="kmeans"></a>kmeans</h4><p>总体目标是最小化聚类中心与每个样本的欧式距离，先随机初始化K个聚类中心，根据欧式距离进行划分，更新聚类中心，不断重复，直到达到指定的聚类次数或者收敛为止。缺点是需要指定K类，以及初始点对划分结果影响很大</p>
<h4 id="kNN"><a href="#kNN" class="headerlink" title="kNN"></a>kNN</h4><p>有监督的分类算法，K个最相似（欧式距离）的样本中的大多数属于某个类别，则该样本也属于该类</p>
<h4 id="欧式距离"><a href="#欧式距离" class="headerlink" title="欧式距离"></a>欧式距离</h4><p>指的是两个向量的距离相似度，欧式距离越小代表向量越趋于相似（二、三维空间中就是点的实际距离），公式如下$$\rho = \sqrt{\sum_{i=1}^{n}(x_{i}-y_{i})^{2}}$$ </p>
<h4 id="余弦距离"><a href="#余弦距离" class="headerlink" title="余弦距离"></a>余弦距离</h4><p>指的是两个向量的方向相似度，余弦值越大（归一化后点乘），代表向量越相似。</p>
<h3 id="图像相似度匹配算法"><a href="#图像相似度匹配算法" class="headerlink" title="图像相似度匹配算法"></a>图像相似度匹配算法</h3><h4 id="BOF（Bag-of-Features）算法"><a href="#BOF（Bag-of-Features）算法" class="headerlink" title="BOF（Bag of Features）算法"></a>BOF（Bag of Features）算法</h4><blockquote>
<ul>
<li>视觉单词提取：提取所有图片的ORB特征并concat到一起[M, N, D]</li>
<li>视觉词典构建：采用K-Means算法，聚成K个类，每个聚类有一个类心，那么这K个类心就相当于词袋中的K个基本词汇。</li>
<li>图像表示：统计每张图片在每个聚类中的特征个数，这样每个图片就可以由一个分布直方图表示，或者说用一个K维的向量表示，向量第i维的值为该图片在第i个聚类中的特征个数。那么每个图像都可以由基本词汇表示。</li>
<li>图像检索：对于一个待检索的图像，我们先提取该图像的图像特征，并产生该图像的分布直方图(K维向量)。然后进行图像向量的余弦相似度度量便可以了</li>
</ul>
</blockquote>
<h4 id="VALD算法："><a href="#VALD算法：" class="headerlink" title="VALD算法："></a>VALD算法：</h4><blockquote>
<ul>
<li>ORB对每张图像提取特征[N, D]</li>
<li>聚类[K,D]</li>
<li>以每个center为中心，进行残差计算并累加(每个N和其对应的center(label))[K, D]</li>
<li>将矩阵拉成一个[K, D]的长向量，对该向量的每一个分量进行幂律归一化（需保持符号不变），公式如下：$$v_{j} := \left | v_{j} \right |^{\alpha } \times sign(v_{j}), j = 1,2, … D$$幂律归一化的目的是主要为了减少某些特征出现次数特别多带来的影响，这是因为出现次数特别多时聚类中心就在它附近，相应的残差就很小，这样便可以抑制数值大的数同时提升数值小的数</li>
<li>对每个分量进行L2范数归一化 <code>normalize(Vlad,Vlad,-1.0,1.0,NORM_L2)</code></li>
<li>采用PCA进行降维，得到该图像的VALD特征向量，之后进行图像向量的余弦相似度度量便可以了</li>
</ul>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/04/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/04/git/" itemprop="url">git</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-04T18:23:29+08:00">
                2018-05-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/04/git/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/04/git/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>上传本地项目到    <code>github</code>仓库中，便于代码的管理、更新，步骤如下：</p>
<h4 id="在github上新建一个repository，并记录该仓库地址"><a href="#在github上新建一个repository，并记录该仓库地址" class="headerlink" title="在github上新建一个repository，并记录该仓库地址"></a>在github上新建一个repository，并记录该仓库地址</h4><h4 id="使用命令行进行上传"><a href="#使用命令行进行上传" class="headerlink" title="使用命令行进行上传"></a>使用命令行进行上传</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd 项目跟目录</span></span><br><span class="line">git init <span class="comment"># 建立本地git仓库</span></span><br><span class="line">git add . <span class="comment"># 添加所有文件到该仓库</span></span><br><span class="line">git commit -m <span class="string">"first commit"</span> <span class="comment"># 提交到仓库</span></span><br><span class="line">git remote add origin git@github.com:Wxjwjj/Facial-Landmark.git <span class="comment"># 本地的仓库关联到GitHub，后面是你新建的github仓库地址</span></span><br><span class="line">git pull origin master <span class="comment"># 上传github之前pull一下</span></span><br><span class="line">git push -u origin master <span class="comment"># 上传代码到GitHub远程仓库</span></span><br></pre></td></tr></table></figure>
<h4 id="使用命令行进行代码更新"><a href="#使用命令行进行代码更新" class="headerlink" title="使用命令行进行代码更新"></a>使用命令行进行代码更新</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git status <span class="comment"># 查看当前的git仓库状态</span></span><br><span class="line">git add *</span><br><span class="line">git commit -m <span class="string">"更新说明"</span></span><br><span class="line">git pull</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/04/reallandmark/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/04/reallandmark/" itemprop="url">实时人脸68关键点检测 for Mac/iOS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-04T16:34:50+08:00">
                2018-05-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/04/reallandmark/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/04/reallandmark/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>前段时间的人脸68关键点检测项目，需要移植到手机端，而且需要达到实时性，所以对算法进行了改进。大致的解决方案是，由于人脸检测耗时较大，所以搭配追踪、模板匹配、ROI区域内检测算法。用一幅图说明如下所示：<br><img src="/img/real.png" width="400" alt="图片名称" align="center"></p>
<h4 id="Mac端需要先配置dlib依赖"><a href="#Mac端需要先配置dlib依赖" class="headerlink" title="Mac端需要先配置dlib依赖"></a>Mac端需要先配置dlib依赖</h4><p>直接使用brew安装下面两个依赖<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install openblas</span><br><span class="line">brew install opencv</span><br></pre></td></tr></table></figure></p>
<p>X11是执行Unix程序的图形窗口环境。Mac OS X本身的程序是Aqua界面的，但是为了能够兼容unix和linux移植过来的程序（Mac OS X由BSD-UNIX修改而来），比如MatLab，就需要x11窗口环境。<br>&nbsp;<br>运行dlib需要X11，但Mac目前没有自带X11，需要重新下载安装，<a href="https://www.xquartz.org/" target="_blank" rel="noopener">下载地址</a><br>下载后直接安装，默认安装目录为/opt/X11，需要在/usr/loca/opt目录下创建软连接（最好使用绝对地址），创建命令如下，创建后重启Mac。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/opt</span><br><span class="line">ln -s /opt/X11 X11</span><br></pre></td></tr></table></figure></p>
<h4 id="real-dlib-muban-roi-cpp"><a href="#real-dlib-muban-roi-cpp" class="headerlink" title="real_dlib_muban_roi.cpp"></a>real_dlib_muban_roi.cpp</h4><p>功能：实时单人脸区域检测(从摄像头读取)，及人脸68个关键点位置检测<br>实时帧率：23 fps<br>视频大小：320$\ast$240 标清<br>硬件平台：Intel(R) Core(TM) i5 @ 2.70GHz（Mac）<br>算法描述：<br>1、先进行Face Detect得到第一帧中人脸区域；<br>2、将该区域放大1.2倍，取为ROI区域；<br>3、在ROI区域中进行模板匹配（模板为前一帧中检测的人脸）<br>4、假如模板匹配算法得分较低，或者<code>bbox</code>超出了图像边界(即人脸出界)，则在整张图中重新进行Face Detect<br>调用指令： <code>./real_dlib_muban_roi</code></p>
<p>Tips：笔者也尝试过在ROI区域中不执行模板匹配，而是直接执行Face Detect，但实际人脸静止情况下，检测到的人脸位置突变极大。折腾了两三天，不断运行代码，发现位置分布居然是有规律的，就在几个固定位置跳动。<br>突然意识到人脸检测器不是每个像素划窗的(🤦‍♂️)，而是每20/40个像素滑，这样就不能在ROI区域中完美匹配到上次的位置。所以采取了模板匹配的方法，挨个像素滑动，这样检测位置便是正确的了。</p>
<h4 id="video-Seeta-Track-cpp"><a href="#video-Seeta-Track-cpp" class="headerlink" title="video_Seeta_Track.cpp"></a>video_Seeta_Track.cpp</h4><p>功能：实时单人脸区域检测（从视频读取），及人脸68个关键点位置检测<br>实时帧率：25 fps<br>视频大小：320$\ast$240 标清<br>硬件平台：Intel(R) Core(TM) i5 @ 2.70GHz（Mac）<br>算法描述：追踪代码运行超过75次，或者追踪失败的情况下，调用Face Detect函数，重新进行人脸位置检测<br>调用指令： <code>./video_Seeta_Track</code><br>检测demo附图：<img src="/img/tracking.png" width="500" alt="图片名称" align="center"></p>
<h4 id="real-dlib-cpp-real-seeta-cpp"><a href="#real-dlib-cpp-real-seeta-cpp" class="headerlink" title="real_dlib.cpp / real_seeta.cpp"></a>real_dlib.cpp / real_seeta.cpp</h4><p>功能：多人脸区域检测(从摄像头读取)，及多人脸68个关键点位置检测<br>实时帧率：8～10 fps<br>视频大小：320$\ast$240 标清<br>硬件平台：Intel(R) Core(TM) i5 @ 2.70GHz（Mac）<br>算法描述：<br>这两个算法，仅用了face detect，而detect在人脸关键点检测项目中，占据的时间较长，所以仅用检测，无法在mac上达到实时效果。<br>调用指令：<code>./real_dlib</code>，<code>./real_seeta.cpp</code></p>
<p>作为对比，分别对seetaface、dlib库进行了测试，发现两个face detect库耗时相当，seetaface人脸检测器，能检测到更小的人脸[40,40]，人脸偏转一定角度(45度范围内)，基本也能检出。而dlib的优势在于其稳定性，这个应该跟模型设计的划窗步长相关，见第二点’Tips’中的分析。</p>
<h4 id="Pic-LandMark68-cpp"><a href="#Pic-LandMark68-cpp" class="headerlink" title="Pic_LandMark68.cpp"></a>Pic_LandMark68.cpp</h4><p>功能：多人脸区域检测(从图片读取)，及多人脸68个关键点位置检测<br>算法描述：<br>采用Seetaface进行人脸检测，dlib进行后续的人脸关键点检测<br>调用指令：<code>./build/Pic_LandMark68 1.png ./model/seeta_fd_frontal_v1.0.bin</code><br>检测demo附图：<img src="/img/Test_box_1.jpg" width="650" alt="图片名称" align="center"></p>
<h4 id="Github代码连接"><a href="#Github代码连接" class="headerlink" title="Github代码连接"></a>Github代码连接</h4><p>上述代码已经全部上传至github，目前仅实现了实时单人脸68关键点绘制，后面有时间话再完善多人关键点检测代码吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># clone该工程</span><br><span class="line">cd Video_Face</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make # 即可在build文件夹中生成可执行程序，调用方式如上</span><br></pre></td></tr></table></figure></p>
<p>PS：<code>dlib</code>、<code>Seetaface</code>的相关代码我也一起打包到工程中了，如果你自己编译安装了OpenCV，用上述CMakeLists便可以。如果你没有编译OpenCV，恰巧又是Mac平台，可以使用我编译好的OpenCV动态库，就在<code>libs</code>文件夹，OpenCV头文件在<code>include</code>文件夹。<br><a href="https://github.com/Wxjwjj/Facial-Landmark" target="_blank" rel="noopener">github代码链接</a></p>
<h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref:"></a>Ref:</h3><p><a href="https://github.com/seetaface/SeetaFaceEngine" target="_blank" rel="noopener">Face detect模块采用山世光老师开源的seetaface</a><br><a href="https://github.com/davisking/dlib" target="_blank" rel="noopener">Facial Landmark模块采用了dlib库</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/mask/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/mask/" itemprop="url">论文笔记：《Mask R-CNN》</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-02T14:33:35+08:00">
                2018-05-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/02/mask/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/02/mask/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>得到4个采样点后，分别采用双线性插值$$f(i+u,j+v) = (1-u)(1-v)f(i,j)+(1-u)(v)f(i,j+1)+(1-v)(u)f(i+1,j)+uvf(i+1,j+1)$$本质就是在X/Y两个方向做线性插值（<a href="https://blog.csdn.net/xiaqunfeng123/article/details/17362881" target="_blank" rel="noopener">算法解析</a>），来计算4个虚拟点的像素值。之后再进行max/average pooling，得到池化后的结果</p>
<h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref:"></a>Ref:</h3><p>📎：<a href="http://blog.leanote.com/post/afanti/b5f4f526490b" target="_blank" rel="noopener">详解 ROI Align 的基本原理和实现细节</a><br>📎：<a href="https://www.davex.pw/2018/02/14/paper-reading-of-mask-rcnn/" target="_blank" rel="noopener">目标检测：Mask R-CNN 论文阅读</a><br>📎：<a href="http://lanbing510.info/2017/12/08/Mask-RCNN.html" target="_blank" rel="noopener">Mask RCNN-论文简记</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/28/data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/28/data/" itemprop="url">C++连接SQL Server数据库入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-28T14:52:08+08:00">
                2018-04-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/28/data/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/04/28/data/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>客户端(网络或C++终端等)管理器通过一系列知名的API（ODBC, OLE-DB, ADO…）提供的不同方式来访问数据库。<br><strong>Tips1:</strong>表现出来的就是同一个数据库，C++中初始化这些API时，方式稍有不同(下面会有代码)，但整体的调用方式，sql语句执行方式都是相同的。<br><strong>Tips2:</strong>另外，不论是<code>access</code>、<code>mysql</code>、<code>sql server</code>，都可以通过同一套API进行访问，以统一的方式处理所有的数据库。</p>
<h4 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h4><p><strong>API:</strong>（ODBC, OLE-DB, ADO…）<br><strong>驱动程序：</strong> 是一些DLL，提供了API和数据库之间的接口。<br><strong>数据源：</strong> 包含了数据库位置和数据库类型等信息，实际上是一种数据连接的抽象。</p>
<h4 id="数据库系统和文件系统的关系"><a href="#数据库系统和文件系统的关系" class="headerlink" title="数据库系统和文件系统的关系"></a>数据库系统和文件系统的关系</h4><p>数据库的数据是结构化的，有联系的；而文件系统各记录无联系<br>关系型数据库（相对于文件系统，是各个分散独立无关系的。但数据表中A项目设置N个属性，便建立了多种关系）<br><img src="/img/db1.jpg" width="400" alt="图片名称" align="center"></p>
<h4 id="ODBC、ADO、DSN关系是什么？"><a href="#ODBC、ADO、DSN关系是什么？" class="headerlink" title="ODBC、ADO、DSN关系是什么？"></a>ODBC、ADO、DSN关系是什么？</h4><p><strong>DSN(Data Source Name):</strong> 为ODBC定义了一个确定的数据库和必须用到的ODBC驱动程序（换句话说要ODBC就必须要建立DSN）<br><strong>ODBC API：</strong> 访问技术只适用于windows系统，因为需要在ODBC驱动程序管理器中进行数据源注册<br><strong>ADO API：</strong> 具有跨系统平台特性，移植性好，无需手动设置DSN连接</p>
<h4 id="手动建立数据库及数据表"><a href="#手动建立数据库及数据表" class="headerlink" title="手动建立数据库及数据表"></a>手动建立数据库及数据表</h4><blockquote>
<ul>
<li>下载安装SQL Server 2016并启动服务（启动方式见<a href="https://blog.csdn.net/u013719984/article/details/51108816" target="_blank" rel="noopener">【启动】</a>）</li>
<li>找到Managemant studio，点击到SQL Server登陆界面，设置user id：sa，pass word：xxxxxx</li>
<li>右键【数据库】，添加一个名为【track】的数据库</li>
<li>右键【track】，添加一张名为【photos】的数据表（会自动带前缀dbo）（如果新表未显示，刷新数据库即可）</li>
<li>右键【photos】，点击【表】，弹出【列名】、【数据类型】设置窗口，设置两个列属性”path”、”features”，数据类型均为”int”</li>
<li>右键【photos】，点击【编辑前200行】，可手动增删数据表中的数据，在此我们添加1行数据，path值：888；features值：111。</li>
</ul>
</blockquote>
<p>设计好的数据库界面如图所示<br><img src="/img/data1.png" width="350" alt="图片名称" align="center"></p>
<h4 id="C-连接SQL"><a href="#C-连接SQL" class="headerlink" title="C++连接SQL"></a>C++连接SQL</h4><p>首先建立一个win32应用程序，在<code>#include &quot;stdafx.h&quot;</code><br>头文件中加入DLL文件，如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt; // cerr头文件</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"C:\Program Files\Common Files\System\ado\msado15.dll"</span> no_namespace rename(<span class="meta-string">"EOF"</span>,<span class="meta-string">"adoEOF"</span>)</span></span><br></pre></td></tr></table></figure></p>
<p><code>data.cpp</code>文件如下，注释都在代码中。此处采用OLE-DB连接，与ADO一样，具有较强的可移植性。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _tmain(<span class="keyword">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line"> _ConnectionPtr m_pConnection;</span><br><span class="line"> _CommandPtr m_pCommand;</span><br><span class="line"> _RecordsetPtr m_pRecodeset;</span><br><span class="line"></span><br><span class="line"> HRESULT hr = CoInitialize(<span class="literal">NULL</span>); <span class="comment">//初始化COM  </span></span><br><span class="line"> hr = m_pConnection.CreateInstance(<span class="string">"ADODB.Connection"</span>);  <span class="comment">// 建立数据库连接</span></span><br><span class="line"> <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Init failed!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"> <span class="keyword">try</span></span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">_bstr_t</span> strConnect = <span class="string">"Provider=SQLOLEDB.1;Persist Security Info=True;Initial Catalog = track; Data Source = 192.168.1.190; User ID = sa; PassWord = 123456;"</span>;</span><br><span class="line">  <span class="comment">//Data Source为主机IP地址，若为access数据库，则为数据库文件名："xxx.mdb"</span></span><br><span class="line">  <span class="comment">//Initial Catalog：数据库名</span></span><br><span class="line">  <span class="comment">//User ID：用户名</span></span><br><span class="line">  <span class="comment">//PassWord：用户密码</span></span><br><span class="line"></span><br><span class="line">  hr = m_pConnection-&gt;Open(strConnect, <span class="string">""</span>, <span class="string">""</span>, adModeUnknown);</span><br><span class="line">  <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">   <span class="built_in">cout</span> &lt;&lt; <span class="string">"Open failed!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">catch</span> (_com_error e)&#123;</span><br><span class="line">  <span class="comment">//MessageBox(e.Description(), "warning");</span></span><br><span class="line">  <span class="built_in">cerr</span> &lt;&lt; <span class="string">"ERROR:"</span> &lt;&lt; (<span class="keyword">char</span>*)e.Description();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">_bstr_t</span> bstrSQL;</span><br><span class="line">    bstrSQL = <span class="string">"update  photos set path = 555 where features = 111"</span>; <span class="comment">// SQL语句，修改features属性中value == 111的path值。</span></span><br><span class="line"> m_pConnection-&gt;Execute(bstrSQL, <span class="literal">NULL</span>, adCmdText); <span class="comment">// 执行SQL语句</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ODBC连接上面写到过只能在win平台，且需要手动建立DSN连接。DSN建立连接方式如下：</p>
<blockquote>
<ul>
<li>【控制面板】——【管理工具】——【ODBC数据源】根据你的电脑选择32、64位</li>
<li>接着在【用户DSN、系统DSN】中均要添加相应的数据源，<a href="https://blog.csdn.net/kepa520/article/details/50403083" target="_blank" rel="noopener">【添加方式】</a> </li>
</ul>
</blockquote>
<p>接下来仅修改<code>data.cpp</code>文件中<code>connection</code>处的代码即可<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> strConnection = <span class="string">"dsn="</span>;</span><br><span class="line">strConnection += <span class="string">"sql"</span>;</span><br><span class="line">strConnection += <span class="string">";uid="</span>;</span><br><span class="line">strConnection += <span class="string">"sa"</span>;</span><br><span class="line">strConnection += <span class="string">";pwd="</span>;</span><br><span class="line">strConnection += <span class="string">"123456"</span>;</span><br><span class="line">strConnection += <span class="string">";"</span>;</span><br><span class="line">hr = m_pConnection-&gt;Open(strConnection.c_str(),<span class="string">""</span>,<span class="string">""</span>,adModeUnknown);</span><br></pre></td></tr></table></figure></p>
<p>Ref:<br>📎：<a href="https://blog.csdn.net/ptsx0607/article/details/68941750" target="_blank" rel="noopener">数据库原理分析</a><br>📎：<a href="https://blog.csdn.net/u013719984/article/details/51108816" target="_blank" rel="noopener">C++与SQL Server2008连接及配置</a><br>📎：<a href="https://blog.csdn.net/kepa520/article/details/50403083" target="_blank" rel="noopener">用数据源(ODBC)创建数据库连接DSN设置</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/dlAdr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/dlAdr/" itemprop="url">Deeplearning.ai课程备忘录(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-15T18:33:56+08:00">
                2018-04-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/15/dlAdr/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/04/15/dlAdr/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>工作后很少有时间进行理论知识的充电，抽出晚上的时间，再把吴恩达前辈的Deeplearning.ai课程过一遍，重在记录之前掌握不牢靠及容易忽视的知识点。</p>
<h3 id="神经网络和深度学习"><a href="#神经网络和深度学习" class="headerlink" title="神经网络和深度学习"></a>神经网络和深度学习</h3><p>课程的第一讲，从经典的线性回归、逻辑回归、激活函数、损失函数、梯度下降几个方面，引出了神经网络知识，以下：</p>
<h4 id="浅层神经网络"><a href="#浅层神经网络" class="headerlink" title="浅层神经网络"></a>浅层神经网络</h4><p>1、NN(neural networks)类似于多层逻辑回归网络，不断执行wx+b、激活、wa+b、激活….到loss function的计算<br>一张图代表逻辑回归和神经元<br><img src="/img/NN1.jpeg" width="300" alt="图片名称" align="center"><br>2、论文中一般说的两层神经网络，为input、hidden、output形式，默认input为0层。<br>3、对于一个样本：wx+b的循环转矩阵的快速运算，[4,3]乘[3,1]加[4,1] 等于<a href="output">4,1</a>。<br><img src="/img/NN2.jpeg" width="300" alt="图片名称" align="center"><br>而对于batch个样本(此处假设有3个样本)，即是把样本特征横向堆叠即可，即：[4,3]乘[3,3]加[4,3] 等于[4,3]，如图示：<br><img src="/img/NN3.jpeg" width="500" alt="图片名称" align="center"><br>4、激活函数<br><strong>sigmoid：</strong>最常用的二分类函数，表达式如下，导数为$g(z)(1-g(z))$，所以最大值为0.25<br>$$g(z)=\frac{1}{1+e^{-z}}$$<br><strong>tanh：</strong>表达式如下，相当于将sigmoid函数平移，然后进行纵向拉伸(-1,1)，除 了最后一层二分类使用sigmoid，中间的hidden layer极力推荐tanh取代它。但这两个函数在Z很大或者很小时，都会发生梯度消失，导数趋近于0。tanh的导数为$(1-g(z)^{2})$<br>$$g(z)=\frac{e^{z}-e^{-z}}{e^{z}+e^{-z}}$$<br><strong>Relu：</strong>表达式为：$a = max(0,z)$，相对来说不容易梯度消失，Z&gt;0时，导数为1，Z&lt;0时，导数为0。Z=0时不可导，我们指定它为0或1就好了(实际Z=0的概率非常低)。三者中目前较常用的函数是Relu，对于拥有大量节点的神经网络来说，总会有很多Z&gt;0的神经元，梯度下降速度还是比较可观的。<br>&nbsp;<br><strong>leaker Relu：</strong>表达式为：$a = max(0.01\ast z,z)$，此处的0.01是个参数，你可以改成其它值进行尝试，说到底就是梯度下降速度的问题（太大了可能扯着蛋…）<br>5、神经网络权重(w)不能初始化为全0，因为这样导致每个神经元对输出的贡献是一样的，所以反向传播后神经元修正也一样。换句话说每个隐藏单元都在计算一样的函数，没有什么意义。<br><code>python:$ w = np.random.randn((2,2))0.01</code>，如前所示，浅层神经网络用接近0的一个高斯分布随机值初始化。深层NN吴恩达老师卖了个关子，且听下次分解吧 </p>
<h3 id="改善深层神经网络"><a href="#改善深层神经网络" class="headerlink" title="改善深层神经网络"></a>改善深层神经网络</h3><p>主要解决神经网络超参数优化原因及方法</p>
<h4 id="正则化缓解过拟合"><a href="#正则化缓解过拟合" class="headerlink" title="正则化缓解过拟合"></a>正则化缓解过拟合</h4><p>L2正则化（有时也称weight decay）：$J_{new} = J + \frac{\lambda}{2m}\left | w \right |^{2}$，其中$\left | w\right |^{2}  = \sum_{j=1}^{n}w_{j}^{2} = w^{T}w$。或者如下公式(m:样本数量，n：权重w数量)，可以看到lambda足够大时，会使得权重矩阵w很小，大致想象，再深的网络都可以化为逻辑回归的样式。<br>$$min_{\theta }  \frac{1}{2m} \sum_{i=1}^{m}(h_{\theta }(x^{i})-y^{i})^{2}+\lambda \sum_{j=1}^{n}\theta_{j}^{2}$$<br>换种较理性的方式来解说是：假如激活函数采用tanh，lambda越大，w越小，$g(z)=wx+b$越小，激活函数此时位于斜率$k=1$的线性段(相对来说比较线性的区间)，线性激活函数是拟合不出复杂的边界的。</p>
<h4 id="Dropout正则化"><a href="#Dropout正则化" class="headerlink" title="Dropout正则化"></a>Dropout正则化</h4><p>反向随机失活推导</p>
<h4 id="其它缓解过拟合的方法"><a href="#其它缓解过拟合的方法" class="headerlink" title="其它缓解过拟合的方法"></a>其它缓解过拟合的方法</h4><p>数据扩充(左右对称、随机裁剪放大、旋转一定角度、扭曲)，early stoping </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/11/cmake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/11/cmake/" itemprop="url">CMakeLists入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-11T22:01:34+08:00">
                2018-04-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/11/cmake/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/04/11/cmake/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>最近在编写各个C++项目时，经常用到CMakeLists.txt，今天花了半天时间进行了初步学习，现有一个<code>test</code>工程目录，内部的<code>src</code>及工程文件夹下各有一个cpp文件如图示。<br>&nbsp;<br>example<br>├── build<br>├── CMakeLists.txt<br>├── include<br>│   └── Detection.h<br>├── libs<br>├── main.cpp<br>└── src<br>    ├── CMakeLists.txt<br>    └── Detection.cpp</p>
<p>直接编写CMakeLists.txt，注释已经比较清楚了如下所示<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>.<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(examples)</span><br><span class="line"></span><br><span class="line"><span class="comment"># find_package()该指令会从8个系统路径查找包，但事先指定CMAKE_PREFIX_PATH(优先级最高的查找路径)，再去找包，保证可以万无一失，就跟在ccmake中指定一样的道理。</span></span><br><span class="line"></span><br><span class="line">list(APPEND CMAKE_PREFIX_PATH <span class="string">"/usr/local/Cellar/opencv/3.4.1_2"</span>) </span><br><span class="line"><span class="keyword">find_package</span>(OpenCV)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># message("OpenCV_INCLUDE_DIRS is : $&#123;OpenCV_INCLUDE_DIRS&#125;")</span></span><br><span class="line"><span class="comment"># message("OpenCV_LIBRARIES is $&#123;OpenCV_LIBS&#125;")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PROJECT_SOURCE_DIR 跟 CMakeLists.txt文件位置保持一致</span></span><br><span class="line"><span class="comment"># message("SOURCE_DIR is $&#123;PROJECT_SOURCE_DIR&#125;")  </span></span><br><span class="line"><span class="comment"># message("BINARY_DIR is $&#123;PROJECT_BINARY_DIR&#125;")</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. SRC_LIST) <span class="comment"># 当前目录下的所有源文件</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">"$&#123;SRC_LIST&#125;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># where to find Headers</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># set 显示的指定变量，把多个cpp文件指定到src_files中</span></span><br><span class="line"><span class="keyword">set</span>(src_files</span><br><span class="line">    main.cpp</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将src子目录加入工程，并指定编译输出路径为bin 目录。如果不指定bin目录，编译结果都将存放在build/src目录，通过这种方式生成的静态库不需要再link_directories。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># src目录有自己的CMakelists，指导其编译</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(src bin)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者先编译src，将生成的静态库放入libs目录，再通过下式link即可</span></span><br><span class="line"><span class="comment"># link_directories($&#123;PROJECT_SOURCE_DIR&#125;/libs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pack objects to static library</span></span><br><span class="line"><span class="keyword">add_library</span>(main STATIC <span class="variable">$&#123;src_files&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(demo main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(demo <span class="variable">$&#123;OpenCV_LIBS&#125;</span> detect)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ps:</span></span><br><span class="line"><span class="comment"># 1，变量使用$&#123;&#125;方式取值，但是在IF控制语句中是直接使用变量名</span></span><br><span class="line"><span class="comment"># 2，指令(参数1 参数2...) 参数使用括弧括起，参数之间使用空格或分号分开，风格统一即可</span></span><br><span class="line"><span class="comment"># 3，指令是大小写无关的，参数和变量是大小写相关的。</span></span><br></pre></td></tr></table></figure></p>
<p><code>src</code>文件夹下的CPP也需要一个CMakeLists.txt进行编译，它的内容如下所示：<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>.<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(detect)   <span class="comment"># 如果此处未重新定义project，那么$&#123;PROJECT_SOURCE_DIR&#125;指的是上一级cmake所指的目录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/../<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(src_files </span><br><span class="line">    Detection.cpp</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span>(LIBRARY_OUTPUT_PATH <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/../libs) <span class="comment"># 注意这里变量名后加'/'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(detect STATIC <span class="variable">$&#123;src_files&#125;</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="一点顿悟"><a href="#一点顿悟" class="headerlink" title="一点顿悟"></a>一点顿悟</h4><p>笔者本身做算法研发的，最近接触了一些SDK编写方面的任务，调试CMakeLists的动态、静态库时，突然就想明白了二者的区别。<br>&nbsp;<br>在打包成exe时，静态库会和代码一起打包，这样给到其他用户时基本下载即可使用，无需下载opencv等“乱七八糟”的东西。而动态库则不行，动态库的exe并没有将其打包，只是留了动态库的借口。换句话说，用户使用你的demo时，一定要指到对应的第三库上。比如opencv3.4.1，要么他自己安装一份，要么你把用到的opencv打包一起传给他使用。<br>&nbsp;<br>那他们的优缺点是什么呢？静态库虽然使用方便，但每个demo都需要一份独有的库(因为已经被打包到一起了)，这样就会造成一定的空间浪费。而动态库，英文也叫”share lib”，每个demo可以共享同一份动态库，需要时调用对应的库便可以。<font color="red">对于Mac中，动态库的路径是绝对路径，给笔者最初的调试也造成了很大的困扰。而Linux中，动态库使用相对路径，只要指到对应的库就好。</font></p>
<p><strong>Eg：</strong></p>
<blockquote>
<ul>
<li>本机：/home/wuxj/opencv/lib/libxxx.so </li>
<li>其他用户：/home/zhaorui/opencv/lib/libxxx.so</li>
<li>Linux系统，libxxx.so吻合就ok；而Mac必须动态库路径才行，显然这样的指向，Mac就Error了</li>
</ul>
</blockquote>
<p>Linux中常用动态库的方法是指定库搜索路径，<code>export LD_LIBRARY_PATH=&lt;Path_to_libs&gt;:$LD_LIBRARY_PATH</code><br>&nbsp;<br>另外需要注意在CMakelists中带版本的动态库，需要指向其不带版本的软连接，因为ld查找时就是基于规则libxxxxx.so的查找。而cmake生成带版本的动态库时，会自动生成其相应软连接。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/11/dlib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/11/dlib/" itemprop="url">dlib(C++)人脸关键点检测 for Linux/Mac</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-11T14:14:58+08:00">
                2018-04-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/11/dlib/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/04/11/dlib/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>上一篇章讲解了Seetaface在Mac端的编译与demo，但Seetaface关键点检测(facial landmark detection)只包含5个关键点，用于人脸姿态矫正完全没问题，但用于美颜、加挂件等场合，则无法施展拳脚。<br>&nbsp;<br>笔者尝试了编译<a href="http://dlib.net/" target="_blank" rel="noopener">dlib C++ Library</a>，这是一个开源的C++图像处理、机器学习库，可以作为opencv的一个良好补充，采用Seetaface Detect模块，检测人脸区域，接着将该区域(Rect)输入dlib的关键点检测模型，可以快速实现人脸68个关键点检测。<br>硬件环境：Intel(R) Core(TM) i5 @ 2.70GHz（mac），单张图片单个人脸，两兄弟默契配合，检测时间如下所示：</p>
<blockquote>
<ul>
<li>Seeta_人脸检测耗时：0.1840 秒</li>
<li>dlib_人脸关键点检测耗时：0.0023 秒</li>
</ul>
</blockquote>
<p>检测效果如图（原图来源于网络，侵删）：<br><img src="/img/dlib1.jpeg" width="350" alt="图片名称" align="center"></p>
<h4 id="dlib的依赖"><a href="#dlib的依赖" class="headerlink" title="dlib的依赖"></a>dlib的依赖</h4><p>dlib安装需要的依赖有openblas，opencv。可以直接使用brew安装。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install openblas</span><br><span class="line">brew install opencv</span><br></pre></td></tr></table></figure></p>
<p>X11是执行Unix程序的图形窗口环境。Mac OS X本身的程序是Aqua界面的，但是为了能够兼容unix和linux移植过来的程序（Mac OS X由BSD-UNIX修改而来），比如MatLab，就需要x11窗口环境。<br>&nbsp;<br>运行dlib需要X11，但Mac目前没有自带X11，需要重新下载安装，<a href="https://www.xquartz.org/" target="_blank" rel="noopener">下载地址</a><br>下载后直接安装，默认安装目录为/opt/X11，需要在/usr/loca/opt目录下创建软连接（最好使用绝对地址），创建命令如下，创建后重启Mac。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/opt</span><br><span class="line">ln -s /opt/X11 X11</span><br></pre></td></tr></table></figure></p>
<h4 id="编译dlib"><a href="#编译dlib" class="headerlink" title="编译dlib"></a>编译dlib</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/davisking/dlib.git  <span class="comment"># 下载dlib</span></span><br><span class="line"><span class="built_in">cd</span> dlib/examples  </span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line">cmake .. -DUSE_SSE4_INSTRUCTIONS=ON 进行配置</span><br><span class="line">cmake --build . --config Release（此处都是demo，没必要全部进行build，需要用到那些build一下就好了)</span><br></pre></td></tr></table></figure>
<p>运行一个<code>build</code>好的demo<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dlib/examples/build/</span><br><span class="line">wget http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2  <span class="comment">#下载face landmark模型，并解压文件</span></span><br><span class="line">./webcam_face_pose_ex</span><br></pre></td></tr></table></figure></p>
<p>至此，会出现X11窗口，打开Mac摄像头自动检测人脸并标注人脸的landmar。</p>
<h5 id="dlib-Rect-与-opencv-Rect转换"><a href="#dlib-Rect-与-opencv-Rect转换" class="headerlink" title="dlib::Rect 与 opencv::Rect转换"></a>dlib::Rect 与 opencv::Rect转换</h5><p>dlib、opencv Rect结构体参数是不同的，所以需要进行一下转换<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// cv 转 dlib</span><br><span class="line">dlib::rectangle dlibrect;</span><br><span class="line">dlibrect = dlib::rectangle((long)face_rect.tl().x, (long)face_rect.tl().y, (long)face_rect.br().x - 1, (long)face_rect.br().y - 1);</span><br><span class="line">// dlib 转 cv，分别为左上、右下[x,y]坐标</span><br><span class="line">faces[i].left(), faces[i].top(), faces[i].right()+1, faces[i].bottom()</span><br></pre></td></tr></table></figure></p>
<h5 id="dlib加载图像的两种方式"><a href="#dlib加载图像的两种方式" class="headerlink" title="dlib加载图像的两种方式"></a>dlib加载图像的两种方式</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">array2d&lt;rgb_pixel&gt; cimg;  <span class="comment">//dlib方式读取图像（从图像路径）</span></span><br><span class="line">load_image(cimg, srcImagePath); </span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;full_object_detection&gt; shapes;</span><br><span class="line"></span><br><span class="line">array2d&lt;bgr_pixel&gt; cimg(gallery_img_color.rows, gallery_img_color.cols); <span class="comment">//dlib方式读取图像（从cv::MAT）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; gallery_img_color.rows; i++) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j &lt; gallery_img_color.cols; j++) </span><br><span class="line">    &#123;</span><br><span class="line">        cimg[i][j].blue = gallery_img_color.at&lt; cv::Vec3b&gt;(i,j)[<span class="number">0</span>];</span><br><span class="line">        cimg[i][j].green= gallery_img_color.at&lt; cv::Vec3b&gt;(i,j)[<span class="number">1</span>];</span><br><span class="line">        cimg[i][j].red = gallery_img_color.at&lt; cv::Vec3b&gt;(i,j)[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ref:<br>📎：<a href="http://noahsnail.com/2016/12/10/2016-12-11-Mac%E4%B8%8Bdlib%E5%AE%89%E8%A3%85/" target="_blank" rel="noopener">Mac下dlib安装</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/29/Seetaface-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/29/Seetaface-linux/" itemprop="url">Seetaface 人脸识别 for Linux/Mac</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-29T14:33:12+08:00">
                2018-03-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/29/Seetaface-linux/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/29/Seetaface-linux/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近做人脸检测的项目，需要用到中科院山世光老师团队开源的SeetaFace，在Ubuntu、Mac端分别进行了编译，系统信息如下：</p>
<blockquote>
<p>Ubuntu:16.04     opencv:3.1.0    cmake:3.5.1<br>MacOS:10.13        opencv:3.4.3    cmake:3.0.2</p>
</blockquote>
<h4 id="FaceDetection-模块"><a href="#FaceDetection-模块" class="headerlink" title="FaceDetection 模块"></a>FaceDetection 模块</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/&lt;user name&gt;/SeetaFaceEngine/FaceDetection</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure>
<p>不出意外即可在build目录下生成可执行文件<code>facedet_test</code>，调用方式<code>./facedet_test image_path ../model/seeta_fd_frontal_v1.0.bin</code>，结果如图示<br><img src="/img/seeta1.jpeg" width="400" alt="图片名称" align="center"><br><strong>PS:</strong><br>1、编译阶段若提示opencv版本问题<br>ccmake .. 修改其中OpenCV_DIR路径为自己的opencv安装目录，configuration使之生效<br>Eg：OpenCV_DIR /home/<user name="">/opencv-3.1.0/build<br>接着设置CUDA_USE_STATIC_CUDA_RUNTIME OFF<br>重新<code>cmake ..</code>，不报错再继续<code>make</code>。</user></p>
<h4 id="FaceAlignment-模块"><a href="#FaceAlignment-模块" class="headerlink" title="FaceAlignment 模块"></a>FaceAlignment 模块</h4><p>该模块依赖FaceDetection，先检测图像中哪个区域存在人脸，之后进行关键点检测，所以先复制FaceDetection模块中的相关头文件、依赖、模型到FaceAlignment/build目录中，具体如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/&lt;user name&gt;/SeetaFaceEngine/FaceAlignment</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cp ../../FaceDetection/include/face_detection.h ../include</span><br><span class="line">cp ../../FaceDetection/build/libseeta_facedet_lib.so ./</span><br><span class="line">cp ../../FaceDetection/model/seeta_fd_frontal_v1.0.bin ./</span><br></pre></td></tr></table></figure></p>
<p>接着修改<code>face_alignment_test.cpp</code>中，FaceDetection model路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Initialize face detection model</span><br><span class="line">seeta::FaceDetection detector(&quot;./build/seeta_fd_frontal_v1.0.bin&quot;);</span><br></pre></td></tr></table></figure></p>
<p>接着编译<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure></p>
<p>之后运行下<code>./build/fa_test</code>，生成如图示的关键点检测图片(注意.cpp文件中定义了仅能检测一张人脸)<br><img src="/img/seeta2.jpeg" width="400" alt="图片名称" align="center"><br><strong>PS:</strong><br>1、编译阶段若提示‘isnan’ was not declared in this scope，定位到源文件，修改为<code>std::isnan</code>便可以了。<br>2、运行阶段提示Segmentation fault (core dumped)，应该是模型或图片路径不对，对于Linux或mac，cpp文件中指定的路径应当是相对于<code>CMakelists.txt</code>的路径</p>
<h4 id="FaceIdentification-模块"><a href="#FaceIdentification-模块" class="headerlink" title="FaceIdentification 模块"></a>FaceIdentification 模块</h4><p>类似的步骤如上，把FaceDetection、FaceAlignment模块的相关依赖拷贝进入build文件夹。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/&lt;user name&gt;/SeetaFaceEngine/FaceAlignment</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cp ../../FaceDetection/include/face_detection.h ../include</span><br><span class="line">cp ../../FaceDetection/build/libseeta_facedet_lib.so ./</span><br><span class="line">cp ../../FaceDetection/model/seeta_fd_frontal_v1.0.bin ./</span><br><span class="line">cp ../../FaceAlignment/include/face_alignment.h ../include</span><br><span class="line">cp ../../FaceAlignment/build/libseeta_fa_lib.so ./</span><br><span class="line">cp ../../FaceAlignment/model/seeta_fa_v1.1.bin ./</span><br></pre></td></tr></table></figure></p>
<p>解压FaceIdentification/model中的两个文件(解压part1，会自动将part2解压)，同样修改<code>./src/test</code>目录的两个CPP文件中，前两个model的路径，同上。<br>&nbsp;<br>再修改<code>/test</code>下的两个cpp文件，加上<code>opencv2</code>头文件，注意这里头文件顺序需要放在<code>cvLIB</code>宏定义之后，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;opencv2/opencv.hpp&gt;</span><br><span class="line">#include &lt;opencv2/highgui/highgui.hpp&gt;</span><br><span class="line">#include &lt;opencv2/imgproc/imgproc.hpp&gt;</span><br></pre></td></tr></table></figure></p>
<p>接着编译<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure></p>
<p>之后运行<code>./build/src/test/test_face_recognizer.bin</code>，测试3个模块。<code>./build/src/test/test_face_verification.bin</code>测试存取的样本中图片的相似度即可。<br><strong>PS:</strong><br>1、编译到99%时报错，提示没有相关的库，需要改写/src/test中的Cmakelists.txt，在其中添加Detect、Align模块的lib库（也就是在当前build文件夹下查找），如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory (. SRC_LIST)</span><br><span class="line">link_directories(<span class="variable">$&#123;PROJECT_BINARY_DIR&#125;</span>) <span class="comment"># 添加lib库搜索路径</span></span><br><span class="line">message(<span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"><span class="comment"># add external libraries</span></span><br><span class="line">find_package(OpenCV REQUIRED)</span><br><span class="line">include_directories(<span class="variable">$&#123;seeta_facedet_lib_INCLUDE_DIRS&#125;</span> <span class="variable">$&#123;seeta_fa_lib_INCLUDE_DIRS&#125;</span>)</span><br><span class="line">list(APPEND seeta_fi_lib_required_libs <span class="variable">$&#123;OpenCV_LIBS&#125;</span> seeta_facedet_lib seeta_fa_lib)</span><br><span class="line">enable_testing ()</span><br><span class="line">foreach (f <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line">  string(REGEX REPLACE <span class="string">"[.]cpp"</span> <span class="string">".bin"</span> BIN <span class="variable">$&#123;f&#125;</span>)</span><br><span class="line">  add_executable(<span class="variable">$&#123;BIN&#125;</span> <span class="variable">$&#123;f&#125;</span>)</span><br><span class="line">  <span class="comment">#target_link_libraries($&#123;BIN&#125; viplnet $&#123;OpenCV_LIBS&#125; seeta_facede_lib seeta_fa_lib)</span></span><br><span class="line">  target_link_libraries(<span class="variable">$&#123;BIN&#125;</span> viplnet <span class="variable">$&#123;seeta_fi_lib_required_libs&#125;</span>) <span class="comment"># 添加lib</span></span><br><span class="line">endforeach ()</span><br></pre></td></tr></table></figure></p>
<h4 id="Mac编译"><a href="#Mac编译" class="headerlink" title="Mac编译"></a>Mac编译</h4><p>与Linux相比，Mac的就非常简单了，需要注意Detection模块中，CMakelists.txt要求的cmake为3.1及以上，笔者是3.0，所以在这里对CMakelists.txt做简单修改，如果是Brew安装的opencv，那其他的<code>ccmake</code>配置也不用修改<br>&nbsp;<br>之后的操作步骤与Linux描述的基本一致，编译过程中可能会有很多warning，不用管，直接<code>make</code>即可。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/27/ubtuntusys-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="祥吉">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deep Coding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/27/ubtuntusys-4/" itemprop="url">Ubuntu1604装机系列(五)：认识Ubuntu系统目录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-27T14:08:34+08:00">
                2018-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/27/ubtuntusys-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/27/ubtuntusys-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>装拆了十几遍ubuntu1604系统、opencv3.1/3.4、cuda8/9后，开始慢慢领悟到ubuntu系统文件即一切的魅力。<br>&nbsp;<br><strong>usr：</strong> 并不是user的意思，而是unix system resrouces，所以上述文件夹都是系统目录，跟服务器中的某个单独用户没什么”私人关系”，直白点说，所有用户都可以访问。<br><strong>bin：</strong> 指代binary，二进制/可执行程序的存储目录，直白点说，这里的文件都可以在terminal中直接输入进行访问</p>
<hr>
<p><strong>/bin:</strong> 存储ubuntu很底层的可执行文件，你用到的<code>cp</code>, <code>ls</code>, <code>mv</code>等基本指令都在这里。<br><strong>/usr/bin：</strong>存储系统级的可执行文件，以及apt-get安装的文件。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/bin</span><br><span class="line">ls | grep python     <span class="comment"># 系统自带python</span></span><br><span class="line">python </span><br><span class="line">python3</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ls | grep ssh       <span class="comment"># 笔者apt-get安装的ssh、tmux软件</span></span><br><span class="line">ssh</span><br><span class="line"></span><br><span class="line">ls | grep tmux</span><br><span class="line">tmux</span><br></pre></td></tr></table></figure></p>
<p><strong>/usr/local/：</strong>很多人都说用户自己编译的安装目录就在这里，比如opencv、比如cuda。这种方式一般是通过sudo安装。但刚刚说了这些系统目录所有用户都可以访问，所以当A用户装了cuda8，B用户装了cuda9，A用户装了opencv2，B用户装了opencv3…这样就会造成local目录极其混乱。<br>&nbsp;<br>所以建议在安装<code>cuda</code>、<code>opencv</code>时，在安装选项/cmake中指定安装目录到一可见文件夹，比如<code>/home/cuda/</code>，<code>/home/Matlab</code>，这样即使安装出错，删除整个<code>cuda</code>或<code>Matlab</code>文件夹就行了。就没必要非得安装在<code>/usr/local</code>目录。<br>&nbsp;<br><strong>/usr/local/bin：</strong>存储用户级的可执行文件。还是拿matlab来说，可以将/home/Matlab下的bin文件建立软连接到这里，这样系统就可以搜索到了，在终端直接开启matlab。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /home/Matlab/r2017b/bin/matlab /usr/<span class="built_in">local</span>/bin/matlab</span><br></pre></td></tr></table></figure></p>
<p><strong>小结：</strong><br><code>/usr/...</code>下的文件，所有用户都可以访问<br><code>bin/</code>、<code>/usr/bin</code>、<code>/usr/local/bin</code>，只要在bin目录下的，都可以在terminal中直接访问。关系为层层递进，以上面的matlab来说，你确实也可以将软连接放到前面两个目录。但它没有cp、mv这些指令底层，也没有python这些工具，是每个用户的通用工具。所以放到最上层的local 目录即可。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://ws1.sinaimg.cn/large/006tNc79ly1fnu0obfmlbj30sg0iyabk.jpg"
                alt="祥吉" />
            
              <p class="site-author-name" itemprop="name">祥吉</p>
              <p class="site-description motion-element" itemprop="description">CV/NLP，Studying，Coding</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:wuxj231@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/xj-wu-74/activities" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-rocket"></i>知乎</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/5379129372/home?wvr=5&lf=reg" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">祥吉</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>


              
 
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共34.0k字</span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"your-duoshuo-shortname"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
</body>
</html>
